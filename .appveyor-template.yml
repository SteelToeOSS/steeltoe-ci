version: '2.1.0-{branch}-{build}'
init:
  - git config --global core.autocrlf true
image: Visual Studio 2017    
branches:
  only:
    - master
    - dev
    - /^update[0-9]{3}/
environment:
  global:
    DOTNET_SKIP_FIRST_TIME_EXPERIENCE: true
    DOTNET_CLI_TELEMETRY_OPTOUT: 1
install:
  - git clone https://github.com/SteeltoeOSS/steeltoe-ci.git -v
  - ps: steeltoe-ci\scripts\appveyor_install.ps1
test_script:
  - ps: steeltoe-ci\scripts\appveyor_tests.ps1
build_script:
  - ps: steeltoe-ci\scripts\appveyor_build.ps1
artifacts:
  - path: '**\*.nupkg'
deploy:
- provider: NuGet
  skip_symbols: false
  artifact: /.*\.nupkg/
  server: https://www.myget.org/F/steeltoedev/api/v2/package
  symbol_server: https://www.myget.org/F/steeltoedev/symbols/api/v2/package
  api_key:
    secure: 246ApObnMYYvzDo9Ki72CxxuKfuoqYbrbUK2HLevGIGHXYY6f0OkAdE3EWCwNJ7g
  on:
    branch: dev
    appveyor_repo_tag: false
- provider: NuGet
  skip_symbols: false
  artifact: /.*\.nupkg/
  server: https://www.myget.org/F/steeltoemaster/api/v2/package
  symbol_server: https://www.myget.org/F/steeltoemaster/symbols/api/v2/package
  api_key:
    secure: 246ApObnMYYvzDo9Ki72CxxuKfuoqYbrbUK2HLevGIGHXYY6f0OkAdE3EWCwNJ7g
  on:
    branch: master
    appveyor_repo_tag: false
- provider: NuGet
  skip_symbols: true
  artifact: /.*\.nupkg/
  server: https://www.myget.org/F/steeltoeupdates/api/v2/package
  symbol_server: https://www.myget.org/F/steeltoeupdates/symbols/api/v2/package
  api_key:
    secure: 246ApObnMYYvzDo9Ki72CxxuKfuoqYbrbUK2HLevGIGHXYY6f0OkAdE3EWCwNJ7g
  on:
    branch: /^update[0-9]{3}/
    appveyor_repo_tag: false